"use strict";(self.webpackChunklunar_calendar=self.webpackChunklunar_calendar||[]).push([[393],{393:(t,e,n)=>{n.d(e,{connectionPool:()=>r,optimizedFirebaseOperations:()=>a});var o=n(815),s=n(220),c=n(45),i=n(751);const r=new class{constructor(){this.connections=new Map,this.maxConnections=50,this.connectionTimeout=3e5,this.cleanupInterval=6e4,this.startCleanup()}createConnection(t){const e=this.generateConnectionId(t);if(this.connections.has(e))return this.connections.get(e);this.connections.size>=this.maxConnections&&this.cleanupOldConnections();try{const n=(0,o.Wp)(t,e),r=(0,s.aU)(n),a=(0,c.getAuth)(n),l={id:e,app:n,db:r,auth:a,storage:(0,i.c7)(n),createdAt:Date.now(),lastUsed:Date.now(),useCount:0};return this.connections.set(e,l),l}catch(n){return console.error("Error creating Firebase connection:",n),null}}getConnection(t){const e=this.generateConnectionId(t),n=this.connections.get(e);return n?(n.lastUsed=Date.now(),n.useCount++,n):this.createConnection(t)}generateConnectionId(t){return`${t.projectId}_${t.authDomain}`}cleanupOldConnections(){const t=Date.now(),e=[];for(const[c,i]of this.connections.entries())t-i.lastUsed>this.connectionTimeout&&e.push(c);e.sort(((t,e)=>{const n=this.connections.get(t),o=this.connections.get(e);return n.lastUsed-o.lastUsed}));const n=Math.floor(.7*this.maxConnections),o=Math.min(e.length,this.connections.size-n);for(let c=0;c<o;c++){const t=e[c],n=this.connections.get(t);if(n)try{n.app}catch(s){}this.connections.delete(t)}}startCleanup(){setInterval((()=>{this.cleanupOldConnections()}),this.cleanupInterval)}getStats(){const t=Array.from(this.connections.values()),e=t.reduce(((t,e)=>t+e.useCount),0),n=t.length>0?e/t.length:0;return{totalConnections:this.connections.size,maxConnections:this.maxConnections,averageUseCount:n,oldestConnection:t.length>0?Math.min(...t.map((t=>t.lastUsed))):0,newestConnection:t.length>0?Math.max(...t.map((t=>t.lastUsed))):0}}clear(){for(const[t,e]of this.connections.entries());this.connections.clear()}},a={getFirestore(t){const e=r.getConnection(t);return e?e.db:null},getAuth(t){const e=r.getConnection(t);return e?e.auth:null},getStorage(t){const e=r.getConnection(t);return e?e.storage:null},async batchOperation(t,e){const n=r.getConnection(e);if(!n)throw new Error("Failed to get Firebase connection");const{db:o}=n,c=(0,s.wP)(o);try{return t.forEach((t=>{"set"===t.type?c.set(t.ref,t.data):"update"===t.type?c.update(t.ref,t.data):"delete"===t.type&&c.delete(t.ref)})),await c.commit(),{success:!0}}catch(i){return console.error("Batch operation failed:",i),{success:!1,error:i.message}}},async optimizedQuery(t,e){const n=r.getConnection(e);if(!n)throw new Error("Failed to get Firebase connection");const{db:o}=n,{collection:c,where:i,orderBy:a,limit:l}=t;try{let t=(0,s.rJ)(o,c);i&&i.forEach((e=>{t=(0,s.P)(t,(0,s._M)(e.field,e.operator,e.value))})),a&&a.forEach((e=>{t=(0,s.P)(t,(0,s.My)(e.field,e.direction))})),l&&(t=(0,s.P)(t,(0,s.AB)(l)));return(await(0,s.GG)(t)).docs.map((t=>({id:t.id,...t.data()})))}catch(h){throw console.error("Optimized query failed:",h),h}}}}}]);